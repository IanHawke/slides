<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Numerical Methods in GR</title>

		<meta name="description" content="ETK, Dublin, 2022">
		<meta name="author" content="Ian Hawke">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<link rel="stylesheet" href="../math1058/reveal.js/dist/reset.css">
		<link rel="stylesheet" href="../math1058/reveal.js/dist/reveal.css">
		<link rel="stylesheet" href="../math1058/reveal.js/dist/theme/white.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="../math1058/reveal.js/plugin/highlight/monokai.css">

	<style type="text/css">
	  .reveal p {
	    text-align: left;
	  }
	  .reveal ul {
	    display: block;
	  }
	  .reveal ol {
	    display: block;
	  }

		.reveal pre code {
			font-size: 1.4em !important;
			line-height: 1.4 !important;
		}
		.container{
		    display: flex;
		}
		.col{
		    flex: 1;
		}
	</style>




	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				<section id="Title">

					<section data-background="figures/gibbs2.svg" data-background-position='right' data-background-size="40%">
						<div style="float: center; width: 60%">
							<h2 class="r-fit-text">Numerical Methods in GR </h2>
							<p style="margin: 50px">
								<ul style="list-style: none;">
									<li> Ian Hawke
								</ul>
							</p>
							<p>
								<ul style="list-style: none;">
									<li> <a href="https://https://github.com/IanHawke">github.com/IanHawke</a></li>
									<li> <a href="https://orcid.org/0000-0003-4805-0309">orcid.org/0000-0003-4805-0309</a></li>
									<li> STAG, University of Southampton</li>
								</ul>
							</p>
							<p style="margin: 50px">
								<ul style="list-style: none;">
									<li> <a href="https://ianhawke.github.io/slides/et-2022">ianhawke.github.io/slides/et-2022</a> </li>
								</ul>
							</p>
						</div>
						<aside class="notes">
							This will be a rapid, surface level summary of numerical methods within the ETK, following on from the talks so far.
						</aside>
					</section>

				</section>

				<section id="Focus">

					<section>

						<div class="container">
							<div class="col">
<!--						<div style="position:absolute; width:768px; top:50px; left:0px">-->

							<h2>The aim</h2>

							<p>
								Numerics:
							</p>
							<ol>
								<li>
									given model,
								</li>
								<li>
									find observable
								</li>
								<li>
									 to given accuracy
								 </li>
								 <li>
									 using minimum resources.
								 </li>
							 </ol>
							<p class="fragment" data-fragment-index=1>
								ETK:
							</p>
							<ol class="fragment" data-fragment-index=1>
								<li>
									within GR,
								</li>
								<li>
									find GW signal from binary merger
								</li>
								<li>
									to 1 radian phase accuracy
								</li>
								<li>
									using minimum CPU time.
								</li>
							</ol>
						</div>

							<div class="col">
<!--						<div style="position:absolute; width:768px; top:0px; left:768px"> -->
							<img src="figures/pch/sqrtPSD_OoE_NSE.svg" style="width:680px; margin:0px">
							<img src="figures/pch/sqrtPSD_OoE_OEL.svg" style="width:680px; margin:0px">
							</div>
						</div>

						<aside class="notes">
							No best method etc.
						</aside>

					</section>

					<section>
						<div class="container">
								<div class="col">
							<!--												<div style="position:absolute; width:768px; top:50px; left:0px; margin:0px"> -->

							<h2>The models</h2>

							<ol>
								<li>
									EFEs $\implies$ wave equation
									$$
									\partial_{tt} \phi = c^2 \nabla^2 \phi;
									$$
								</li>
								<li>
									Charge conservation $\implies$ advection
									$$
									\partial_t \phi + \nabla_k \left( \phi v^k \right) = 0;
									$$
								</li>
								<li>
									$\nabla_a T^{ab} \; \implies$ balance laws
									$$
									\partial_t q + \nabla_k f^{(k)}(q) = s(q);
									$$
								 </li>
								 <li>
									 Exchange $\implies$ relaxation
									 $$
									 \dot{q} = \tau^{-1} s(q).
									 $$
								 </li>
							 </ol>

						</div>
							<div class="col">
<!--
						<div style="position:absolute; width:768px; top:0px; left:768px; margin:0px"> -->
							<video controls data-autoplay loop="true" src="figures/toy_models.mp4" style="width:768px; margin:0px">
							</div>
						</div>
						<aside class="notes">
							No generic best numerical method - problem dependent. ETK was designed for a particular task.
						</aside>

					</section>

					<section>
						<div class="container">
							<div class="col">
<!--
						<div style="position:absolute; width:768px; top:50px; left:0px">-->

							<h2>Split out time</h2>

							<p>
								Method of Lines (thorn <code>MoL</code>):
							</p>
							<ol>
								<li>
									start from spacetime;
								</li>
								<li>
									discretize space, giving ODEs;
								</li>
								<li>
									 solve ODEs.
							 </li>
							</ol>
							<p class="fragment" data-fragment-index=1>
								(Dis)advantages:
							</p>
							<ul class="fragment" data-fragment-index=1>
								<li>
									causality restricts $\Delta t$;
								</li>
								<li>
									width of stencil affects cost;
								</li>
								<li>
									MoL simplifies coupling;
								</li>
								<li>
									accuracy, efficiency issues.
								</li>
							</ul>

						</div>
							<div class="col r-stack">
<!--
						<div style="position:absolute; width:768px; top:0px; left:768px" class="r-stack"> -->
							<img src="figures/mol1.svg" style="width:100%">
							<img src="figures/mol2.svg" style="width:100%" class="fragment fade-in" data-fragment-index=1>
							</div>
						</div>

						<aside class="notes">
							No generic best numerical method - problem dependent. ETK was designed for a particular task.
						</aside>

					</section>

					<section>
						<div class="container">
							<div class="col">
<!--
						<div style="position:absolute; width:800px; top:50px; left:0px"> -->

							<h2>Finite differencing</h2>

							<p>
								Approximate:
							</p>
							<ol>
								<li>
									fields $\phi$ as point values $\phi_i = \phi(x_i)$;
								</li>
								<li>
									polynomial interpolation gives $\hat{\phi}(x)$ from $\{\phi_i\}$;
								</li>
								<li>
									 derivative from $\partial_x \phi \simeq \partial_x \hat{\phi}$.
							 </li>
							</ol>
							<p>
								See <code>Kranc</code>, <code>NRPy</code>.
							</p>
							<div class="fragment" data-fragment-index=1>
								<p>
									Example:
								</p>
								$$
								\begin{aligned}
									&& \partial_t \phi + \partial_x (v \phi) & = 0 \\
									\rightarrow && \partial_t \phi_i & = \frac{-v \left( \phi_{i+1} - \phi_{i-1} \right)}{2 \, \Delta x}.
								\end{aligned}
								$$
							</div>
						</div>
							<div class="col r-stack">
<!--
						<div style="position:absolute; width:736px; top:0px; left:800px" class="r-stack"> -->
							<img src="figures/fd_example.svg" style="width:100%">
							<video controls data-autoplay loop="true" src="figures/fd_compare.mp4" style="width:100%" class="fragment fade-in" data-fragment-index=1>
							</div>
						</div>

						<aside class="notes">
							No generic best numerical method - problem dependent. ETK was designed for a particular task.
						</aside>

					</section>

					<section>
						<div class="container">
							<div class="col">
<!--
						<div style="position:absolute; width:800px; top:50px; left:0px"> -->

							<h2>Order of accuracy</h2>

							<p>
								Finite differencing errors $\propto \Delta x^p = N^{-p}$:
							</p>
							$$
							\partial_t \phi_i + \frac{v \left( \phi_{i+1} - \phi_{i-1} \right)}{2 \, \Delta x} = \mathcal{O} \left( \Delta x^3 \right).
							$$
							<p>
								$\Delta x$ "small": higher order usually better. However, costs increase:
							</p>
							$$
							\partial_x \phi \simeq \frac{-\phi_{i+2} + \phi_{i-2} + 8 (\phi_{i+1} - \phi_{i-1})}{12 \, \Delta x}.
							$$
							<p class="fragment" data-fragment-index=1>
								Usual to plot convergence with $N$ or $\Delta x$. Really resource (eg CPU time) that matters.
							</p>
						</div>
							<div class="col">
<!--
						<div style="position:absolute; width:736px; top:0px; left:800px">-->
							<img src="figures/fd_costs.svg" style="width:100%">
							</div>
						</div>

						<aside class="notes">
							No generic best numerical method - problem dependent. ETK was designed for a particular task.
						</aside>

					</section>

					<section>
						<div class="container">
							<div class="col">
<!--
						<div style="position:absolute; width:768px; top:50px; left:0px">-->

							<h2>Phase errors</h2>

							<p>
								Finite differencing errors:
							</p>
							<ol>
								<li>
									dissipation, reducing amplitude;
								</li>
								<li>
									dispersion, changing phase.
							 </li>
							</ol>
							<div class="r-stack">
								<div class="fragment fade-in-then-out" data-fragment-index=1>
									<p>
										Phase error dependence on $\Delta x$ can be estimated.
									</p>
									<p>
										For 1kHz wave for 1s, 1% phase error:
									</p>
									<table>
										<tr>
											<th>$2^{\textrm{nd}}$ order</th>
											<th>$4^{\textrm{th}}$ order</th>
											<th>$6^{\textrm{th}}$ order</th>
										</tr>
										<tr>
											<td>$10$m</td>
											<td>$265$m</td>
											<td>$784$m</td>
										</tr>
									</table>
								</div>
								<div class="fragment" data-fragment-index=2>
									<p>
										Phase errors dependence on $\Delta x$ can be estimated.
									</p>
									<p>
										For 10kHz wave for 1s, 0.01% phase error:
									</p>
									<table>
										<tr>
											<th>$2^{\textrm{nd}}$ order</th>
											<th>$4^{\textrm{th}}$ order</th>
											<th>$6^{\textrm{th}}$ order</th>
										</tr>
										<tr>
											<td>$0.3$m</td>
											<td>$47$m</td>
											<td>$247$m</td>
										</tr>
									</table>
								</div>
							</div>
						</div>
							<div class="col">
<!--
						<div style="position:absolute; width:768px; top:0px; left:768px" class="r-stack"> -->
							<video controls data-autoplay loop="true" src="figures/damping_dx0_05.mp4" style="width:100%">
							</div>
						</div>

						<aside class="notes">
							No generic best numerical method - problem dependent. ETK was designed for a particular task.
						</aside>

					</section>

					<section>
						<div class="container">
							<div class="col">
<!--
						<div style="position:absolute; width:768px; top:50px; left:0px">-->

							<h2>Spectral</h2>

							<p>
								Higher order is better: use all information. Mode expand:
							</p>
							$$
							\phi = \sum_i \hat{\phi}_i \sin \left(\frac{2 \pi i x}{L} \right).
							$$
							<p>
								Then $\partial_x \phi \simeq D \hat{\phi}$.
							</p>
							<p>
								Spectral error $\sim \exp(-p N)$.
							</p>
							<p class="fragment" data-fragment-index=1>
								Accuracy of full evolution often constrained.
							</p>
							<p class="fragment" data-fragment-index=1>
								ETK has spectral initial data (<code>TwoPunctures</code>, <code>LORENE</code>), no evolution.
							</p>
						</div>
							<div class="col r-stack">
<!--
						<div style="position:absolute; width:768px; top:0px; left:768px" class="r-stack"> -->
							<img src="figures/spectral_deriv.svg" style="width:100%">
							<img src="figures/spectral_costs.svg" style="width:100%" class="fragment" data-fragment-index=1>
							</div>
						</div>

						<aside class="notes">
							No generic best numerical method - problem dependent. ETK was designed for a particular task.
						</aside>

					</section>

					<section>
						<div class="container">
							<div class="col">
<!--
						<div style="position:absolute; width:768px; top:50px; left:0px">-->

							<h2>Discontinuities</h2>

							<p>
								Any high order method shows Gibbs' oscillations at jumps.
							</p>
							<p>
								No convergence with resolution.
							</p>
							<p class="fragment" data-fragment-index=1>
								Use <em>piecewise</em> polynomial reconstruction (eg WENO) to avoid oscillations.
							</p>
							<ul class="fragment" data-fragment-index=2>
								<li>
									Converges with resolution.
								</li>
								<li>
									Formally first order at jumps.
								</li>
								<li>
									<em>Much</em> more expensive.
								</li>
								<li>
									Data dependent - hard to analyse.
								</li>
								<li>
									Extension to higher dimensions an issue.
								</li>
							</ul>
							<p class="fragment" data-fragment-index=3>
								See <code>GRHydro</code>, <code>IllinoisMHD</code>, <code>Spritz</code>, <code>WhiskyTHC</code>.
							</p>
						</div>
							<div class="col r-stack">
<!--
						<div style="position:absolute; width:768px; top:0px; left:768px" class="r-stack">-->
							<img src="figures/gibbs1.svg" style="width:100%">
							<img src="figures/recon21.svg" style="width:100%" class="fragment" data-fragment-index=1>
							<img src="figures/recon81.svg" style="width:100%" class="fragment" data-fragment-index=2>
							<img src="figures/gibbs2.svg" style="width:100%" class="fragment" data-fragment-index=3>
							</div>
						</div>

						<aside class="notes">
							No generic best numerical method - problem dependent. ETK was designed for a particular task.
						</aside>

					</section>

					<section>
						<div class="container">
							<div class="col">
<!--
						<div style="position:absolute; width:768px; top:50px; left:0px">-->

							<h2>Nonlinearity</h2>

							<p>
								Formally need to work with <em>weak form</em>
							</p>
							$$
							\begin{aligned}
								&& \partial_t \phi + \nabla_k f^{(k)}(\phi) & = 0 \\
								\implies && \frac{\text{d}}{\text{d}t} \int_V \phi + \oint_{\partial V} \hat{n}_k  f^{(k)}(\phi) & = 0.
							\end{aligned}
							$$
							<p>
								Discrete version, 1d:
							</p>
							$$
							\frac{\text{d}}{\text{d}t} \hat{\phi}_i + \frac{1}{\Delta x} \left[ f_{i+1/2} - f_{i-1/2} \right] = 0.
							$$
							<p>
								Finding the flux $f_{k \pm 1/2}$ depends on the model (for fluids see <code>GRHydro</code> etc).
							</p>
						</div>
							<div class="col">
<!--
						<div style="position:absolute; width:768px; top:0px; left:768px" class="r-stack">-->
							<img src="figures/weak_solutions1.svg" style="width:100%">
							</div>
						</div>

						<aside class="notes">
							No generic best numerical method - problem dependent. ETK was designed for a particular task.
						</aside>

					</section>

					<section>
						<div class="container">
							<div class="col">
<!--
						<div style="position:absolute; width:768px; top:50px; left:0px">-->

							<h2>Consistency</h2>

							<p>
								Using the right weak form is essential.
							</p>
							$$
							\begin{aligned}
								&& \partial_t q^n + \frac{n}{n+1} \partial_x q^{n+1} & = 0 \\
								\implies && \partial_t q + q \partial_x q & = 0.
							\end{aligned}
							$$
							<p>
								Strong solutions agree when continuous; inconsistent at shocks.
							</p>
							<p class="fragment">
								Can use entropy pairs, path-consistent methods for complex cases. Links to <code>SummationByParts</code>.
							</p>
						</div>
							<div class="col">
<!--
						<div style="position:absolute; width:768px; top:0px; left:768px" class="r-stack"> -->
								<video controls data-autoplay loop="true" src="figures/burgers_n_shock.mp4" style="width:768px;">
								</div>
							</div>

						<aside class="notes">
							No generic best numerical method - problem dependent. ETK was designed for a particular task.
						</aside>

					</section>

					<section>
						<div class="container">
							<div class="col">
<!--
						<div style="position:absolute; width:768px; top:50px; left:0px">-->

							<h2>Parallel compute</h2>

							<p>
								Errors $\sim \Delta x^p$, but also local.
							</p>
							<p>
								Refine mesh where errors large (<code>Carpet(X)</code>).
							</p>
							<p>
								Boundaries need interpolation - source of error.
							</p>
							<p class="fragment">
								Physics not Cartesian: overlapping patches complex, but help (<code>Llama</code>, <code>BH@Home</code>).
							</p>
						</div>
							<div class="col r-stack">
<!--
						<div style="position:absolute; width:768px; top:0px; left:768px" class="r-stack">-->
							<img src="figures/amr.svg" style="width:768px" class="fragment fade-out" data-fragment-index=1>
							<img src="figures/grids.png" style="height:960px" class="fragment" data-fragment-index=1>
							</div>
						</div>

						<aside class="notes">
							No generic best numerical method - problem dependent. ETK was designed for a particular task.
						</aside>

					</section>

					<section>
						<div class="container">
							<div class="col">

								<h2>Adaptive Model</h2>

								<p>
									Changing model can reduce costs by
								</p>
								<ol>
									<li>
										reducing size of state vector;
									</li>
									<li>
										increasing allowed timestep.
									</li>
								</ol>
								<p>
									Choose model <em>adaptively</em> to improve numerics (remove stiffness, increase accuracy) while capturing (enough) physics (for chosen observable).
								</p>
								<p>
									Examples:
								</p>
								<ul>
									<li>
										Low Mach approximation (Harpole);
									</li>
									<li>
										Fast reactions as bulk viscosity (Hammond, Celora, Most);
									</li>
									<li>
										Resistive MHD as ideal plus corrections (Wright).
									</li>
								</ul>
							</div>
							<div class="col">
								<img src="figures/pch/adaptive_model.png" style="height:960px">
							</div>
						</div>

						<aside class="notes">
							No generic best numerical method - problem dependent. ETK was designed for a particular task.
						</aside>

					</section>

					<section>
						<div class="container">
							<div class="col">
<!--
						<div style="position:absolute; width:768px; top:50px; left:0px">-->

							<h2>Mesh refinement</h2>

							<p>
								Errors $\sim \Delta x^p$, but also local.
							</p>
							<p>
								Refine mesh where errors large (<code>Carpet(X)</code>).
							</p>
							<p>
								Boundaries need interpolation - source of error.
							</p>
							<p class="fragment" data-fragment-index=1>
								Physics not Cartesian: overlapping patches complex, but help (<code>Llama</code>, <code>BH@Home</code>).
							</p>
						</div>
							<div class="col r-stack">
<!--
						<div style="position:absolute; width:768px; top:0px; left:768px" class="r-stack">-->
							<img src="figures/amr.svg" style="width:768px" class="fragment fade-out" data-fragment-index=1>
							<img src="figures/grids.png" style="height:960px" class="fragment" data-fragment-index=1>
							</div>
						</div>

						<aside class="notes">
							No generic best numerical method - problem dependent. ETK was designed for a particular task.
						</aside>

					</section>

				</section>

				<section id="Summary">
					<section>

						<h2>Summary</h2>

						<p>
							The ETK is optimized for
						</p>
						<ul>
							<li>
								finite difference/volume methods
							</li>
							<li>
								using block-structured mesh refinement
							</li>
							<li>
								on CPUs
							</li>
							<li>
								for computing gravitational waves.
							</li>
						</ul>
						<p>
							CarpetX should add GPU support.
						</p>
						<p>
							Adaptive and hybrid methods becoming common, but complex.
						</p>

						<aside class="notes">
						</aside>

					</section>

				</section>

			</div>

		</div>


		<script src="../math1058/reveal.js/dist/reveal.js"></script>
		<script src="../math1058/reveal.js/plugin/zoom/zoom.js"></script>
		<script src="../math1058/reveal.js/plugin/notes/notes.js"></script>
		<script src="../math1058/reveal.js/plugin/search/search.js"></script>
		<script src="../math1058/reveal.js/plugin/markdown/markdown.js"></script>
		<script src="../math1058/reveal.js/plugin/highlight/highlight.js"></script>
		<script src="../math1058/reveal.js/plugin/math/math.js"></script>
		<script>

			// Also available as an ES module, see:
			// https://revealjs.com/initialization/
			Reveal.initialize({
				width: 1536,
			  height: 960,
			  margin: 0.04,
				controls: false,
				progress: true,
				center: true,
				hash: true,
				transition: 'none',
				pdfSeparateFragments: true,
				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight, RevealMath.KaTeX ],
			});

		</script>


	</body>
</html>
